<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="AC_LOG_VIEW" >
  <resultMap id="LogEmployee" class="com.megaeyes.persistence.ibatis.vo.ListLogAndEmployeeVO" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Fri May 25 16:52:11 CST 2012.
    -->
    <result column="ID" property="id" jdbcType="VARCHAR" />
    <result column="TRIGGER_ID" property="triggerId" jdbcType="VARCHAR" />
    <result column="DEVICE_TYPE" property="deviceType" jdbcType="VARCHAR" />
    <result column="LOG_TYPE" property="logType" jdbcType="VARCHAR" />
    <result column="TRIGGER_TYPE" property="triggerType" jdbcType="VARCHAR" />
    <result column="DEVICE_ID" property="deviceId" jdbcType="VARCHAR" />
    <result column="TIME" property="time" jdbcType="DECIMAL" />
    <result column="NAMING" property="naming" jdbcType="VARCHAR" />
    <result column="NOTE" property="note" jdbcType="VARCHAR" />
    <result column="EMPLOYEE_ID" property="employeeId" jdbcType="VARCHAR" />
    <result column="EMPLOYEE_NAME" property="employeeName" jdbcType="VARCHAR" />
    <result column="DOOR_NAME" property="doorName" jdbcType="VARCHAR" />
  </resultMap>
  
  <select id="listLogEmployeeByDoorId" resultMap="LogEmployee">
  
  select a.*,d.name as employee_name ,d.id as employee_id,e.name as door_name from 
       ac_log a left join ac_access_cards b on a.trigger_id=b.card_number 
                left join ac_r_employee_card c on b.id=c.card_id 
                left join   ac_employees d on c.employee_id=d.id 
                left join  ac_access_controls e on a.device_id=e.id 
         	<dynamic prepend="where">
			<isNotEmpty prepend="and" property="startTime">
  				  <![CDATA[TIME >=#startTime#]]>
			</isNotEmpty>
			<isNotEmpty prepend="and" property="endTime">
  				  <![CDATA[TIME <=#endTime#]]>
			</isNotEmpty>
			<isNotEmpty prepend="and" property="doorId">
					a.device_id = #doorId#
			</isNotEmpty>
			
				and	a.TRIGGER_TYPE = 'TriggerCard' and d.id is not null
			
  			</dynamic>

 
 
  </select>
  
  
  </sqlMap>