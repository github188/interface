<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="PLATFORM_RESOURCES_VIEW">
	<resultMap class="com.megaeyes.persistence.ibatis.model.PlatformResources"
		id="abatorgenerated_PlatformResourcesResult">
		<!-- WARNING - This element is automatically generated by Abator for iBATIS, 
			do not modify. This element was generated on Thu Jun 09 15:17:49 CST 2011. -->
		<result column="ID" jdbcType="VARCHAR" property="id" />
		<result column="RESOURCE_ID" jdbcType="VARCHAR" property="resourceId" />
		<result column="NAME" jdbcType="VARCHAR" property="name" />
		<result column="NAMING" jdbcType="VARCHAR" property="naming" />
		<result column="SIP_CODE" jdbcType="VARCHAR" property="sipCode" />
		<result column="ORGAN_ID" jdbcType="VARCHAR" property="organId" />
		<result column="IS_SHARE" jdbcType="DECIMAL" property="isShare" />
		<result column="STATUS" jdbcType="DECIMAL" property="status" />
		<result column="LONGITUDE" jdbcType="VARCHAR" property="longitude" />
		<result column="LATITUDE" jdbcType="VARCHAR" property="latitude" />
		<result column="TYPE" jdbcType="VARCHAR" property="type" />
	</resultMap>

	<resultMap class="com.megaeyes.persistence.ibatis.vo.PlatformResourcesVO"
		id="PlatformResourcesVO">
		<result column="RESOURCE_ID" jdbcType="VARCHAR" property="resourceId" />
		<result column="NAME" jdbcType="VARCHAR" property="name" />
		<result column="NAMING" jdbcType="VARCHAR" property="naming" />
		<result column="SIP_CODE" jdbcType="VARCHAR" property="sipCode" />
		<result column="ORGAN_ID" jdbcType="VARCHAR" property="organId" />
		<result column="IS_SHARE" jdbcType="DECIMAL" property="isShare" />
		<result column="STATUS" jdbcType="DECIMAL" property="status" />
		<result column="LONGITUDE" jdbcType="VARCHAR" property="longitude" />
		<result column="LATITUDE" jdbcType="VARCHAR" property="latitude" />
		<result column="TYPE" jdbcType="VARCHAR" property="type" />
		<result column="MODEL_NAME" jdbcType="VARCHAR" property="modelName" />
		<result column="PARENT_ID" jdbcType="VARCHAR" property="parentId" />
	</resultMap>

	<select id="countResources" resultClass="java.lang.Integer">
		select count(*) from platform_resources
		where 1=1
		<isEmpty property="parentId" prepend="and">
			organ_id is null
		</isEmpty>
		<isNotEmpty property="parentId" prepend="and">
			organ_id =
			#parentId:VARCHAR#
		</isNotEmpty>
		and type in ('vis', 'organ')
		and is_share = '1'
	</select>

	<select id="listResources" resultMap="abatorgenerated_PlatformResourcesResult">
		select * from (
		select temp.*, rownum as rid from (
		select * from
		platform_resources
		where 1=1
		<isEmpty property="parentId" prepend="and">
			organ_id is null
		</isEmpty>
		<isNotEmpty property="parentId" prepend="and">
			organ_id =
			#parentId:VARCHAR#
		</isNotEmpty>
		and type in ('vis', 'organ')
		and is_share = '1'
		and rownum <![CDATA[ <= ]]>
		#end#
		) temp ) where rid >= #start#
	</select>

	<select id="listVic" resultMap="PlatformResourcesVO">
		select v.id as RESOURCE_ID,
		v.f_name as NAME, v.naming as NAMING, '' as
		SIP_CODE,
		v.organ_id as
		ORGAN_ID, '1' as IS_SHARE, '1' as STATUS, '' as LONGITUDE, '' as
		LATITUDE,
		'vic' as TYPE, m.f_name as MODEL_NAME,
		v.video_input_server_id as PARENT_ID
		from video_input_channel v,
		video_input_channel_model m
		where m.id = v.video_input_channel_model_id
		order by v.id asc
	</select>

	<select id="listAic" resultMap="PlatformResourcesVO">
		select a.id as RESOURCE_ID,
		a.f_name as NAME, a.naming as NAMING, '' as
		SIP_CODE,
		a.organ_id as
		ORGAN_ID, '1' as IS_SHARE, '1' as STATUS, '' as LONGITUDE, '' as
		LATITUDE,
		'aic' as TYPE, t.f_name as MODEL_NAME, a.alarm_box_id as
		PARENT_ID
		from alarm_input_channel a, alarm_input_channel_type t
		where
		a.alarm_input_channel_type_id = t.id
		order by a.id asc
	</select>

	<select id="listProber" resultMap="PlatformResourcesVO">
		select p.id as RESOURCE_ID,
		p.name as NAME, p.id as NAMING, '' as SIP_CODE,
		s.organ_id as ORGAN_ID,
		'1' as IS_SHARE, '1' as STATUS, '' as
		LONGITUDE, '' as LATITUDE,
		'prober' as TYPE, t.name as MODEL_NAME, p.control_server_id as
		PARENT_ID
		from ep_prober p, ep_prober_type t, ep_control_server s
		where
		p.ep_prober_type_id = t.id
		and p.control_server_id = s.id
		order by p.id
		asc
	</select>

	<select id="listStorageServer" resultMap="PlatformResourcesVO">
		select s.id as
		RESOURCE_ID, s.f_name as NAME, s.naming as NAMING, '' as
		SIP_CODE,
		'' as
		ORGAN_ID, '1' as IS_SHARE, '1' as STATUS, '' as LONGITUDE, '' as
		LATITUDE,
		'server' as TYPE, '' as MODEL_NAME, '' as PARENT_ID
		from
		storage_server s, remote_storage_server r
		where s.id =
		r.storage_server_id
		order by s.id asc
	</select>

	<select id="listVis" resultMap="PlatformResourcesVO">
		select v.id as RESOURCE_ID,
		v.f_name as NAME, v.naming as NAMING, '' as
		SIP_CODE,
		v.company_id as
		ORGAN_ID, '1' as IS_SHARE, '1' as STATUS, '' as LONGITUDE, '' as
		LATITUDE,
		'vis' as TYPE, v.vis_type as MODEL_NAME, v.company_id as
		PARENT_ID
		from video_input_server v
		order by v.id asc
	</select>

	<select id="listUser" resultMap="PlatformResourcesVO">
		select u.id as RESOURCE_ID,
		u.logon_name as NAME, u.naming as NAMING, '' as
		SIP_CODE,
		u.organ_id as
		ORGAN_ID, '1' as IS_SHARE, '1' as STATUS, '' as LONGITUDE, '' as
		LATITUDE,
		'user' as TYPE, u.user_account as MODEL_NAME, u.organ_id as
		PARENT_ID
		from t_user u
		order by u.id asc
	</select>

	<select id="listOrgan" resultMap="PlatformResourcesVO">
		select o.id as RESOURCE_ID,
		o.f_name as NAME, o.id as NAMING, '' as
		SIP_CODE,
		o.parent_organ_id as
		ORGAN_ID, '1' as IS_SHARE, '1' as STATUS, '' as LONGITUDE, '' as
		LATITUDE,
		'organ' as TYPE, o.f_name as MODEL_NAME, o.parent_organ_id as
		PARENT_ID
		from organ o
		where o.parent_organ_id is not null
		order by o.id
		asc
	</select>

	<select id="listVisSharedChildrenId" resultClass="java.lang.String">
		select a.id
		from alarm_input_channel a, alarm_box b, video_input_server s
		where
		a.alarm_box_id = b.id
		and b.video_input_server_id = s.id
		and s.id =
		#visId#
		and exists (select id from platform_resources r where
		r.is_share = '1'
		and r.resource_id = a.id)
		union
		select c.id from
		video_input_channel c, video_input_server s
		where
		c.video_input_server_id = s.id
		and s.id = #visId#
		and exists (select id
		from platform_resources r where r.is_share = '1'
		and r.resource_id =
		c.id)
	</select>

	<select id="listSharedVICWithRSS" resultMap="abatorgenerated_PlatformResourcesResult">
		select p.* from
		platform_resources p
		where p.is_share = '1'
		and p.naming is not null
		and
		exists (
		select 1 from video_input_channel v
		where
		v.remote_storage_server_id = #rssId#
		and v.id = p.resource_id
		)
	</select>

	<select id="getBySipCode" resultMap="abatorgenerated_PlatformResourcesResult">
		select * from
		platform_resources where sip_code = #code#
	</select>

	<select id="getByResourceId" resultMap="abatorgenerated_PlatformResourcesResult">
		select * from
		platform_resources where resource_id = #id# and type = #type#
	</select>
	<select id="listSharedAlarmDevice" resultMap="abatorgenerated_PlatformResourcesResult">
		select temp.* from
		(select id, name, naming, organ_id, resource_id,
		sip_code, is_share, status,
		longitude, latitude, type, rownum as rid
		from platform_resources
		where
		type in ('vic', 'aic', 'prober')
		and
		is_share = '1'
		and rownum <![CDATA[ < ]]>
		#end#) temp
		where rid >= #begin#
	</select>
	<select id="countSharedAlarmDevice" resultClass="java.lang.Integer">
		select count(id) from platform_resources
		where type in ('vic', 'aic', 'prober')
		and is_share = '1'
	</select>
</sqlMap>