<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >

<sqlMap namespace="EP_ALARM_EVENT_VIEW" >

  <resultMap id="abatorgenerated_EpAlarmEventResult" class="com.megaeyes.persistence.ibatis.model.EpAlarmEvent" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Fri May 04 14:14:36 CST 2012.
    -->
    <result column="ID" property="id" jdbcType="VARCHAR" />
    <result column="SESSION_ID" property="sessionId" jdbcType="VARCHAR" />
    <result column="SOURCE_ID" property="sourceId" jdbcType="VARCHAR" />
    <result column="SOURCE_TYPE" property="sourceType" jdbcType="VARCHAR" />
    <result column="THRESHOLD" property="threshold" jdbcType="VARCHAR" />
    <result column="VALUE" property="value" jdbcType="VARCHAR" />
    <result column="BEGIN_TIME" property="beginTime" jdbcType="DECIMAL" />
    <result column="END_TIME" property="endTime" jdbcType="DECIMAL" />
    <result column="CONFIRM_TIME" property="confirmTime" jdbcType="DECIMAL" />
    <result column="NOTE" property="note" jdbcType="VARCHAR" />
    <result column="NAMING" property="naming" jdbcType="VARCHAR" />
    <result column="SOURCE_NAME" property="sourceName" jdbcType="VARCHAR" />
    <result column="EVENT_TYPE_NAME" property="eventTypeName" jdbcType="VARCHAR" />
    <result column="EVENT_LEVEL" property="eventLevel" jdbcType="VARCHAR" />
    <result column="ORGAN_ID" property="organId" jdbcType="VARCHAR" />
    <result column="RECORD_FLAG" property="recordFlag" jdbcType="VARCHAR" />
  </resultMap>
  
  <resultMap id="getResource" class="com.megaeyes.persistence.ibatis.vo.ResourceVO">
  	<result column="NAME" property="name" jdbcType="VARCHAR" />
  	<result column="ORGAN_ID" property="organId" jdbcType="VARCHAR" />
  </resultMap>

  <update id="updateEpAlarmEvent">
	update ep_alarm_event set note = #note#, confirm_time = #confirmTime# where naming = #naming#
  </update>
	
  <select id="listAlarmEvent" resultMap="abatorgenerated_EpAlarmEventResult" >
	select * from (
		select rownum as rid, temp.* from ( 
			select * from ep_alarm_event 
			where 1=1
			<isNotEmpty property="begin" prepend="and">
			  begin_time >= #begin#
			</isNotEmpty>
			<isNotEmpty property="end" prepend="and">
			  begin_time <![CDATA[<]]> #end#
			</isNotEmpty>
			and organ_id in 
			<iterate open="(" close=")" conjunction="," property="organIds">
			  #organIds[]#
			</iterate>
			order by begin_time desc
		) temp )
	where rid >= #start#
	and rid <![CDATA[<]]> #limit#
  </select>
  
  <select id="countAlarmEvent" resultClass="java.lang.Integer" >
	select count(id) from ep_alarm_event 
	where 1=1
	<isNotEmpty property="begin" prepend="and">
	  begin_time >= #begin#
	</isNotEmpty>
	<isNotEmpty property="end" prepend="and">
	  begin_time <![CDATA[<]]> #end#
	</isNotEmpty>
	and organ_id in 
	<iterate open="(" close=")" conjunction="," property="organIds">
	  #organIds[]#
	</iterate>
  </select>
  
  <select id="listEpAlarmEventInDevices" resultMap="abatorgenerated_EpAlarmEventResult">
  	select b.* from
	(select a.*, rownum as rid from
	(select * from ep_alarm_event
  	where 1=1
	<isNotEmpty prepend="and" property="eventTypeName">
		EVENT_TYPE_NAME in
		  <iterate property="eventTypeName" open="(" close=")" conjunction=",">
			#eventTypeName[]#
		  </iterate>
	</isNotEmpty>
	<isNotNull prepend="and" property="beginTime">
	   BEGIN_TIME >= #beginTime#
	</isNotNull>
	<isNotNull prepend="and" property="endTime">
	   BEGIN_TIME <![CDATA[ <]]> #endTime#
	</isNotNull>
	<isNotEmpty prepend="and" property="eventLevel">
	   EVENT_LEVEL = #eventLevel:VARCHAR#
	</isNotEmpty>
	<isNotEmpty prepend="and" property="sourceIds">
	   SOURCE_ID in 
		<iterate property="sourceIds" open="(" close=")" conjunction=",">
			#sourceIds[]#
		</iterate>
	</isNotEmpty>
	order by id desc) a 
	) b where b.rid > #begin#
		and b.rid <![CDATA[ <]]>=#end#
  </select>
  
  <select id="countEpAlarmEventInDevices" resultClass="java.lang.Integer">
  	select count(*) from ep_alarm_event
  	where 1=1
  	<isNotEmpty prepend="and" property="eventTypeName">
		EVENT_TYPE_NAME in
		  <iterate property="eventTypeName" open="(" close=")" conjunction=",">
			#eventTypeName[]#
		  </iterate>
	</isNotEmpty>
	<isNotNull prepend="and" property="beginTime">
	   BEGIN_TIME >= #beginTime#
	</isNotNull>
	<isNotNull prepend="and" property="endTime">
	   BEGIN_TIME <![CDATA[ <]]> #endTime#
	</isNotNull>
	<isNotEmpty prepend="and" property="eventLevel">
	   EVENT_LEVEL = #eventLevel:VARCHAR#
	</isNotEmpty>
	<isNotEmpty prepend="and" property="sourceIds">
	   SOURCE_ID in 
		<iterate property="sourceIds" open="(" close=")" conjunction=",">
			#sourceIds[]#
		</iterate>
	</isNotEmpty>
	order by id desc
  </select>
  
  <select id="getOrganNameById" resultMap="getResource">
    select F_NAME as NAME, PARENT_ORGAN_ID as ORGAN_ID from ORGAN where ID=#id#
  </select>
  
  <select id="getVicNameById" resultMap="getResource">
    select F_NAME as NAME, ORGAN_ID from VIDEO_INPUT_CHANNEL where ID=#id#
  </select>
  
  <select id="getEpProberNameById" resultMap="getResource">
    select NAME, ORGAN_ID from EP_PROBER where ID=#id#
  </select>
  
  <select id="getEpDeviceNameById" resultMap="getResource">
    select NAME, ORGAN_ID from EP_DEVICE where ID=#id#
  </select>
  
  <select id="getAicNameById" resultMap="getResource">
    select F_NAME as NAME, ORGAN_ID from ALARM_INPUT_CHANNEL where ID=#id#
  </select>
  
  <select id="getAocNameById" resultMap="getResource">
    select F_NAME as NAME, ORGAN_ID from ALARM_OUTPUT_CHANNEL where ID=#id#
  </select>
  
  <select id="getVocNameById" resultMap="getResource">
    select F_NAME as NAME, ORGAN_ID from VIDEO_OUTPUT_CHANNEL where ID=#id#
  </select>
  
  <select id="getVisNameById" resultMap="getResource">
    select F_NAME as NAME, COMPANY_ID as ORGAN_ID from VIDEO_INPUT_SERVER where ID=#id#
  </select>
  
  <select id="getACAccessServerNameById" resultMap="getResource">
    select NAME, ORGAN_ID from ac_access_servers where ID=#id#
  </select>
  <select id="getACAccessControlNameById" resultMap="getResource">
    select NAME, ORGAN_ID from ac_access_controls where ID=#id#
  </select>
  <select id="getACAccessCardNumberById" resultMap="getResource">
    select CARD_NUMBER as NAME, ORGAN_ID from ac_access_cards where ID=#id#
  </select>
  <select id="getACGatewayNameById" resultMap="getResource">
    select NAME, ORGAN_ID from ac_gateway where ID=#id#
  </select>
  <select id="getACEmployeeNameById" resultMap="getResource">
    select NAME, '' as ORGAN_ID from ac_employees where ID=#id#
  </select>
  <select id="getICNameById" resultMap="getResource">
    select F_NAME as NAME, ORGAN_ID from intelligent_channel where id=#id#
  </select>
</sqlMap>