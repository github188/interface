<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="AC_ACCESS_CONTROLS_VIEW">
	<resultMap class="com.megaeyes.persistence.ibatis.model.AcAccessControls"
		id="abatorgenerated_AcAccessControlsResult">
		<!-- WARNING - This element is automatically generated by Abator for iBATIS, 
			do not modify. This element was generated on Tue May 17 10:32:59 CST 2011. -->
		<result column="ID" jdbcType="VARCHAR" property="id" />
		<result column="NAME" jdbcType="VARCHAR" property="name" />
		<result column="ORGAN_ID" jdbcType="VARCHAR" property="organId" />
		<result column="NAMING" jdbcType="VARCHAR" property="naming" />
		<result column="INSTALL_LOCATION" jdbcType="VARCHAR" property="installLocation" />
		<result column="DEVICE_NUMBER" jdbcType="VARCHAR" property="deviceNumber" />
		<result column="CHANNEL_ID" jdbcType="DECIMAL" property="channelId" />
		<result column="NOTE" jdbcType="VARCHAR" property="note" />
		<result column="DEVICE_TYPE" jdbcType="DECIMAL" property="deviceType" />
		<result column="ACCESS_SERVER_ID" jdbcType="VARCHAR" property="accessServerId" />
		<result column="STATUS" jdbcType="DECIMAL" property="status" />
		<result column="TECHNICAL_PROTECTION" jdbcType="VARCHAR"
			property="technicalProtection" />
		<result column="PHYSICAL_PROTECTION" jdbcType="VARCHAR"
			property="physicalProtection" />
	</resultMap>

	<resultMap class="com.megaeyes.persistence.ibatis.vo.ListDoorAndVicVO"
		id="abatorgenerated_DoorAndVicResult">
		<!-- WARNING - This element is automatically generated by Abator for iBATIS, 
			do not modify. This element was generated on Tue May 17 10:32:59 CST 2011. -->
		<result column="ID" jdbcType="VARCHAR" property="id" />
		<result column="NAME" jdbcType="VARCHAR" property="name" />
		<result column="ORGAN_ID" jdbcType="VARCHAR" property="organId" />
		<result column="NAMING" jdbcType="VARCHAR" property="naming" />
		<result column="INSTALL_LOCATION" jdbcType="VARCHAR" property="installLocation" />
		<result column="DEVICE_NUMBER" jdbcType="VARCHAR" property="deviceNumber" />
		<result column="CHANNEL_ID" jdbcType="DECIMAL" property="channelId" />
		<result column="NOTE" jdbcType="VARCHAR" property="note" />
		<result column="DEVICE_TYPE" jdbcType="DECIMAL" property="deviceType" />
		<result column="ACCESS_SERVER_ID" jdbcType="VARCHAR" property="accessServerId" />
		<result column="STATUS" jdbcType="DECIMAL" property="status" />
		<result column="TECHNICAL_PROTECTION" jdbcType="VARCHAR"
			property="technicalProtection" />
		<result column="PHYSICAL_PROTECTION" jdbcType="VARCHAR"
			property="physicalProtection" />
		<result column="VIC_ID" jdbcType="VARCHAR" property="vicId" />
		<result column="VIC_NAME" jdbcType="VARCHAR" property="vicName" />
		<result column="VIC_NAMING" jdbcType="VARCHAR" property="vicNaming" />
		<result column="REMOTE_OPEN" jdbcType="VARCHAR" property="remoteOpen" />
	</resultMap>

	<resultMap class="com.megaeyes.persistence.ibatis.vo.ListDoorAndUserVO"
		id="abatorgenerated_DoorAndUserResult">
			<result column="ID" jdbcType="VARCHAR" property="id" />
		<result column="NAME" jdbcType="VARCHAR" property="name" />
		<result column="ORGAN_ID" jdbcType="VARCHAR" property="organId" />
		<result column="NAMING" jdbcType="VARCHAR" property="naming" />
		<result column="INSTALL_LOCATION" jdbcType="VARCHAR" property="installLocation" />
		<result column="DEVICE_NUMBER" jdbcType="VARCHAR" property="deviceNumber" />
		<result column="CHANNEL_ID" jdbcType="DECIMAL" property="channelId" />
		<result column="NOTE" jdbcType="VARCHAR" property="note" />
		<result column="DEVICE_TYPE" jdbcType="DECIMAL" property="deviceType" />
		<result column="ACCESS_SERVER_ID" jdbcType="VARCHAR" property="accessServerId" />
		<result column="STATUS" jdbcType="DECIMAL" property="status" />
		<result column="TECHNICAL_PROTECTION" jdbcType="VARCHAR"
			property="technicalProtection" />
		<result column="PHYSICAL_PROTECTION" jdbcType="VARCHAR"
			property="physicalProtection" />
		<result column="USER_ID" jdbcType="VARCHAR" property="userId" />
		<result column="USER_NAME" jdbcType="VARCHAR" property="userName" />
		<result column="REMOTE_OPEN" jdbcType="VARCHAR" property="remoteOpen" />
	</resultMap>


	<resultMap class="com.megaeyes.persistence.ibatis.vo.UserSessionVO"
		id="userSessionVO">
		<result column="ID" jdbcType="VARCHAR" property="id" />
		<result column="NAMING" jdbcType="VARCHAR" property="naming" />
	</resultMap>

	<select id="countAccessControl" resultClass="java.lang.Integer">
		select count(*) from ac_access_controls
		where 1=1
		<isNotEmpty prepend="and" property="serverId">
			access_server_id = #serverId:VARCHAR#
	</isNotEmpty>
		<isNotEmpty prepend="and" property="name">
			name like '%$name$%'
	</isNotEmpty>
		<isNotEmpty prepend="and" property="deviceType">
			device_type = #deviceType:VARCHAR#
	</isNotEmpty>
	</select>

	<select id="listAccessControl" resultMap="abatorgenerated_AcAccessControlsResult">
		select b.* from
		(select a.*, rownum as rid from ac_access_controls a
		where 1=1
		<isNotEmpty prepend="and" property="serverId">
			access_server_id = #serverId:VARCHAR#
	</isNotEmpty>
		<isNotEmpty prepend="and" property="name">
			name like '%$name$%'
	</isNotEmpty>
		<isNotEmpty prepend="and" property="deviceType">
			device_type = #deviceType:VARCHAR#
	</isNotEmpty>
		and rownum <![CDATA[<]]>
		#end#) b
		where b.rid >= #begin#
	</select>

	<select id="countUserAuthControl" resultClass="java.lang.Integer">
		select count(*) from ac_access_controls a, r_user_accontrol r
		where 1=1
		and r.user_id = #userId:VARCHAR#
		<isNotEmpty prepend="and" property="name">
			a.name like '%$name$%'
	</isNotEmpty>
		and a.id = r.control_id
	</select>

	<select id="listUserAuthControl" resultMap="abatorgenerated_AcAccessControlsResult">
		select b.* from
		(select a.*, rownum as rid from ac_access_controls a, r_user_accontrol r
		where 1=1
		and r.user_id = #userId:VARCHAR#
		<isNotEmpty prepend="and" property="name">
			a.name like '%$name$%'
	</isNotEmpty>
		and a.id = r.control_id
		and rownum <![CDATA[<]]>
		#end#) b
		where b.rid >= #begin#
	</select>

	<select id="countUserNotAuthControl" resultClass="java.lang.Integer">
		select count(*) from ac_access_controls ac
		where not exists
		(select * from ac_access_controls a, r_user_accontrol r
		where r.user_id = #userId:VARCHAR#
		<isNotEmpty prepend="and" property="name">
			a.name like '%$name$%'
	</isNotEmpty>
		and a.id = r.control_id
		and ac.id = r.control_id)
	</select>

	<select id="listUserNotAuthControl" resultMap="abatorgenerated_AcAccessControlsResult">
		select b.* from
		(select ac.*, rownum as rid from ac_access_controls ac
		where not exists
		(select * from ac_access_controls a, r_user_accontrol r
		where r.user_id = #userId:VARCHAR#
		<isNotEmpty prepend="and" property="name">
			a.name like '%$name$%'
	</isNotEmpty>
		and a.id = r.control_id
		and ac.id = r.control_id)
		and rownum <![CDATA[<]]>
		#end#) b
		where b.rid >= #begin#
	</select>

	<select id="listDoorNotifyUsers" resultMap="userSessionVO">
		select s.id, u.naming from t_user u, r_user_accontrol r, user_session s
		where r.user_id = u.id
		and u.id = s.user_id
		and r.control_id = #id:VARCHAR#
  </select>

	<select id="getOrganIdByAccessServerId" resultClass="java.lang.String">
		select organ_id from ac_access_servers where id = #accessServerId#
</select>

	<select id="getNamingByAccessServerId" resultClass="java.lang.String">
		select naming from ac_access_servers where id = #accessServerId#
</select>

	<select id="listAcAccessControlByGatewayId" resultMap="abatorgenerated_AcAccessControlsResult">
		select c.* from
		ac_access_controls c,ac_access_servers a
		where c.access_server_id = a.id and
		a.gateway_id = #gatewayId#
</select>

	<select id="listControlAndVic" resultMap="abatorgenerated_DoorAndVicResult">
		select
		a.*,
		c.f_name VIC_NAME,
		c.naming VIC_NAMING,
		c.id VIC_ID
		from ac_access_controls a
		left join ep_r_door_vic b on a.id=b.door_id
		left join video_input_channel c on b.vic_id=c.id
		where a.organ_id = #organId#
		order by a.id
</select>
	<select id="listControlAndUser" resultMap="abatorgenerated_DoorAndUserResult">
		select
		a.*,
		b.user_id,
		c.f_name USER_NAME 
		from ac_access_controls a left join r_user_accontrol b on
		a.id=b.control_id
		left join t_user c on b.user_id = c.id
		where a.organ_id = #organId#
		order by a.id
</select>

	<select id="listDoorBindVics" resultClass="java.lang.String">
		select vic.naming from ep_r_door_vic r, video_input_channel vic
		where r.door_id = #doorId#
		and r.vic_id = vic.id
	</select>
	
	<select id="listDoorByOrganId" resultMap="abatorgenerated_AcAccessControlsResult">
		select * from ac_access_controls
		where organ_id in (select id from organ org where org.path like	'%$organId$%')
	</select>
</sqlMap>