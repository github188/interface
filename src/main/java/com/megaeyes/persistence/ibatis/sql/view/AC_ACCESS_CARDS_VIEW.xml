<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="AC_ACCESS_CARDS_VIEW" >
  <resultMap id="abatorgenerated_AcAccessCardsResult" class="com.megaeyes.persistence.ibatis.model.AcAccessCards" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Wed May 16 01:37:47 GMT 2012.
    -->
    <result column="ID" property="id" jdbcType="VARCHAR" />
    <result column="NAME" property="name" jdbcType="VARCHAR" />
    <result column="CARD_NUMBER" property="cardNumber" jdbcType="VARCHAR" />
    <result column="NOTE" property="note" jdbcType="VARCHAR" />
    <result column="STATUS" property="status" jdbcType="VARCHAR" />
    <result column="PASSWORD" property="password" jdbcType="VARCHAR" />
    <result column="EXPIRE_DATE" property="expireDate" jdbcType="DECIMAL" />
    <result column="ORGAN_ID" property="organId" jdbcType="VARCHAR" />
  </resultMap>
  
  <resultMap id="abatorgenerated_AcAccessCardsAndEmployeesResult" class="com.megaeyes.persistence.ibatis.vo.ListEmployeesAndCardVO" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Wed May 16 01:37:47 GMT 2012.
    -->
    <result column="ACCESS_EMPLOYEE_ID" property="accessEmployeeId" jdbcType="VARCHAR" />
    <result column="ACCESS_EMPLOYEE_NAME" property="accessEmployeeName" jdbcType="VARCHAR" />
    <result column="ACCESS_EMPLOYEE_NO" property="accessEmployeeNum" jdbcType="VARCHAR" />
    <result column="ID" property="id" jdbcType="VARCHAR" />
    <result column="NAME" property="name" jdbcType="VARCHAR" />
    <result column="CARD_NUMBER" property="cardNumber" jdbcType="VARCHAR" />
    <result column="NOTE" property="note" jdbcType="VARCHAR" />
    <result column="STATUS" property="status" jdbcType="VARCHAR" />
    <result column="PASSWORD" property="password" jdbcType="VARCHAR" />
    <result column="EXPIRE_DATE" property="expireDate" jdbcType="DECIMAL" />
    <result column="ORGAN_ID" property="organId" jdbcType="VARCHAR" />
  </resultMap>
  
   <resultMap id="abatorgenerated_cardAndEmployee" class="com.megaeyes.persistence.ibatis.vo.ListCardAndEmployeeVO" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Wed May 16 01:37:47 GMT 2012.
    -->
    <result column="PASSWORD" property="cPassword" jdbcType="VARCHAR" />
    <result column="CARD_ID" property="cardId" jdbcType="VARCHAR" />
    <result column="AUTHORIZE_TYPE" property="authorizeType" jdbcType="DECIMAL" />
    <result column="EMPLOYEE_ID" property="employeeId" jdbcType="VARCHAR" />
    <result column="EMPLOYEE_NO" property="empNo" jdbcType="VARCHAR" />
    <result column="EMPLOYEE_NAME" property="employeeName" jdbcType="VARCHAR" />
    <result column="EXPIRE_DATE" property="expireDate" jdbcType="DECIMAL" />
    <result column="CARD_NUMBER" property="cardNumber" jdbcType="DECIMAL" />
  </resultMap>
  
  	<select id="listAcAccessCards"
		resultMap="abatorgenerated_AcAccessCardsResult">
		select * from AC_ACCESS_CARDS
	</select>
	
	<select id="getCardByCardNumber"
		resultMap="abatorgenerated_AcAccessCardsResult">
		select * from AC_ACCESS_CARDS where card_number = #cardNumber#
	</select>
  
  
  <select id="listEmployeesAndCard"
		resultMap="abatorgenerated_AcAccessCardsAndEmployeesResult">
		select a.*,c.id as ACCESS_EMPLOYEE_ID,c.name as ACCESS_EMPLOYEE_NAME,c.EMP_NO as ACCESS_EMPLOYEE_NO from  
					ac_access_cards a  left join  ac_r_employee_card b on a.id=b.card_id left join ac_employees c on b.employee_id=c.id
					 where a.organ_id = #organId# 
	</select>
	
	<select id="listCardAndEmployee"
		resultMap="abatorgenerated_cardAndEmployee">
		select a.authorize_Type,
		b.password,
		b.id card_id,
		b.card_number,
		d.id EMPLOYEE_ID,
		d.name EMPLOYEE_NAME,
		d.EMP_NO EMPLOYEE_NO,
		b.expire_date
		 from 
		 ac_r_door_card a left join  ac_access_cards b on a.card_id=b.id 
		 left join ac_r_employee_card c on b.id=c.card_id 
		 left join  ac_employees d on c.employee_id=d.id 
		 where a.door_id = #doorId#
	</select>
	
	 <update id="updateStatus"  >
	 	update ac_access_cards set status = '2' where id in
          (select r.card_id from ac_r_employee_card r where r.employee_id = #employeeId#)
	 </update>
	 
	  <update id="updateStatusByCard"  >
	 	update ac_access_cards set status = '0' where id = #card#
          
	 </update>

</sqlMap>